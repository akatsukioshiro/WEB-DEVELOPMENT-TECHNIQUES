<!DOCTYPE html>
<html>
<head>
<style>
body
{
margin:0;
}
navbar
{
	height:100%;
	width:5vw;
	background:rgba(0,0,0,0.8);
	position:absolute;
	right:0;
	margin:0;
}
.navbutton
{
	min-height:5vw;
	background:rgba(0,0,0,0.6);
	display:block;
	line-height:5vw;
	text-align:center;
	color:white;
	text-decoration:none;
	cursor:pointer;
}
fbody
{
	height:100%;
	width:95vw;
	background:rgba(0,0,0,0.05);
	position:fixed;
	left:0;
	margin:0;
}
</style>
</head>
<body onload="start()">
<navbar>
<div_b id="div_b" class="navbutton">
DIV
</div_b>
<drag_b id="drag_b" class="navbutton">
DRAG
</drag_b>
<a id="sub_b" class="navbutton" href="" download="Output_
Webpage.html">
SUB
</a>
</navbar>
<fbody id="fbody">
</fbody>
<svg id="svg" version="1.1" xmlns="http://www.w3.org/2000/svg" style="width: 95vw; height: 100%; position: absolute;">
</svg>
<script>
var div_identity="";
var downtime=0;
var divmake=0;
var drag=0;
var count=0;
function svgbox(coord,c) 
{
	var nm="poly"+c;
	var poly = document.createElementNS('http://www.w3.org/2000/svg','polygon');
	poly.setAttribute('id',nm);
	poly.setAttribute('points',coord);
	if(nm!=="poly5")poly.setAttribute('fill',"white");
	if(nm==="poly5")poly.setAttribute('fill',"none");
	poly.setAttribute("stroke", "red");
	poly.setAttribute("stroke-width",1);
	if(nm==="poly5")poly.setAttribute("stroke-dasharray","20,10,5,5,5,10");
	document.getElementById('svg').appendChild(poly);
}
function sbox(x,y)
{
	var sx=x+10;
	var sy=y+10;
	var pt="";
	for(var c=1;c<5;c++)
	{
		var x1=x+11;
		var sx1=x1+10;
		var y1=y+11;
		var sy1=y1+10;
		var a0=x+5;
		var a1=y+5;
		var b0=x1+5;
		var b1=y+5;
		var c0=x+5;
		var c1=y1+5;
		var d0=x1+5;
		var d1=y1+5;
		if(c===1)pt=x+","+y+" "+sx+","+y+" "+sx+","+sy+" "+x+","+sy;
		else if(c===2)pt=x1+","+y+" "+sx1+","+y+" "+sx1+","+sy+" "+x1+","+sy;
		else if(c===3)pt=x+","+y1+" "+sx+","+y1+" "+sx+","+sy1+" "+x+","+sy1;
		else if(c===4)pt=x1+","+y1+" "+sx1+","+y1+" "+sx1+","+sy1+" "+x1+","+sy1;
		else if(c===5)pt=a0+","+a1+" "+b0+","+b1+" "+c0+","+c1+" "+d0+","+d1;
		svgbox(pt,c);
	}
}
function fbox(x,y)
{
	var sx=x+5;
	var sy=y+5;
	var pt=sx+","+sy+" "+sx+","+sy+" "+sx+","+sy+" "+sx+","+sy;
	svgbox(pt,5);
}
function remove_svgbox(dt)
{
	if(dt===1)
	for(var c=1;c<6;c++)
	{
		var nm="poly"+c;
		var element = document.getElementById(nm);
		element.parentNode.removeChild(element); 
	}
}
function start()
{
	var pe=document.getElementById("svg");
	pe.style.pointerEvents="none";
	document.documentElement.addEventListener("mousedown",function(e)
	{
		if(document.getElementsByTagName("polygon").length!==0)
		remove_svgbox(1);
		if(divmake===1)//add more options of navbar conditions in or "||"
		{
			pe.style.pointerEvents="auto";
			document.getElementById("svg").style.cursor = "crosshair";
			var x=e.clientX;
			var y=e.clientY;
			fbox(x,y);
			sbox(x,y);
			downtime=1;
		}
	});
	document.documentElement.addEventListener("mouseup",function(e)
	{
		document.getElementById("svg").style.cursor = "initial";
		if(divmake===1)divcall();		
		divmake=0;
		remove_svgbox(downtime);
		downtime=0;
		var pe=document.getElementById("svg");
		pe.style.pointerEvents="none";
	});
	document.getElementById("svg").addEventListener("mousemove",function(e)
	{
		if(downtime===1)
		{
			var refer_pt=document.getElementById("poly1").getAttribute("points");
			var refer_cod=refer_pt.split(" ");
			var rm0=refer_cod[0].split(",");
			var rm1=[(parseInt(rm0[0])+11),rm0[1]];
			var rm2=[rm0[0],(parseInt(rm0[1])+11)];
			var rm3=[(parseInt(rm0[0])+11),(parseInt(rm0[1])+11)];
			var rm4=[(parseInt(rm0[0])+5),(parseInt(rm0[1])+5)];
			if(e.clientX>=(parseInt(rm0[0])+12) && e.clientY>=(parseInt(rm0[1])+12))
			{
				for(var c=2;c<6;c++)
				{
					var nm="poly"+c;
					var pt=document.getElementById(nm).getAttribute("points");
					var cod=pt.split(" ");
					var m=cod[0].split(",");
					var n=cod[1].split(",");
					var o=cod[2].split(",");
					var p=cod[3].split(",");
					if(c===2)
					{
						m[0]=e.clientX;
						n[0]=e.clientX+10;
						o[0]=e.clientX+10;
						p[0]=e.clientX;
						pt=m[0]+","+m[1]+" "+n[0]+","+n[1]+" "+o[0]+","+o[1]+" "+p[0]+","+p[1];
						if(rm1[0]<=m[0] && rm1[1]<=m[1])
						document.getElementById(nm).setAttribute("points",pt);
					}
					else if(c===3)
					{
						m[1]=e.clientY;
						n[1]=e.clientY;
						o[1]=e.clientY+10;
						p[1]=e.clientY+10;
						pt=m[0]+","+m[1]+" "+n[0]+","+n[1]+" "+o[0]+","+o[1]+" "+p[0]+","+p[1];
						if(rm2[0]<=m[0] && rm2[1]<=m[1])
						document.getElementById(nm).setAttribute("points",pt);
					}
					else if(c===4)
					{
						m[0]=e.clientX;
						n[0]=e.clientX+10;
						o[0]=e.clientX+10;
						p[0]=e.clientX;
						m[1]=e.clientY;
						n[1]=e.clientY;
						o[1]=e.clientY+10;
						p[1]=e.clientY+10;
						pt=m[0]+","+m[1]+" "+n[0]+","+n[1]+" "+o[0]+","+o[1]+" "+p[0]+","+p[1];
						if(rm3[0]<=m[0] && rm3[1]<=m[1])
						document.getElementById(nm).setAttribute("points",pt);
					}
					else if(c===5)
					{
						var a=parseInt(rm0[0]);
						var b=parseInt(rm0[1]);
						m[0]=a+5;
						m[1]=b+5;
						n[0]=e.clientX+5;
						n[1]=b+5;
						o[0]=e.clientX+5;
						o[1]=e.clientY+5;
						p[0]=a+5;
						p[1]=e.clientY+5;
						pt=m[0]+","+m[1]+" "+n[0]+","+n[1]+" "+o[0]+","+o[1]+" "+p[0]+","+p[1];
						if(rm4[0]<=m[0] && rm4[1]<=m[1] && rm4[0]<=n[0] && rm4[1]<=n[1] && rm4[0]<=o[0] && rm4[1]<=o[1] && rm4[0]<=p[0] && rm4[1]<=p[1])
						document.getElementById(nm).setAttribute("points",pt);
					}	
				}					
			}
		}
	});
}
document.getElementById("div_b").addEventListener("click",function(e)
{
	divmake=1;
});
function divcall()
{
	var pt=document.getElementById("poly5").getAttribute("points");
	var cod=pt.split(" ");
	var m=cod[0].split(",");
	var n=cod[1].split(",");
	var o=cod[2].split(",");
	var p=cod[3].split(",");
	var a=document.createElement("div");
	a.id="div_"+count;
	count+=1;
	a.style.background="red";
	a.style.height=parseInt(p[1])-parseInt(m[1])+"px";
	a.style.width=parseInt(n[0])-parseInt(m[0])+"px";
	a.style.left=parseInt(m[0])+"px";
	a.style.top=parseInt(m[1])+"px";
	a.style.position="fixed";
	a.setAttribute("state","0");
	a.style.zIndex="1";
	a.dc_param=a.id;
	a.addEventListener("click",div_control,false);
	//a.addEventListener("click",function(e){alert("hi");});
	document.getElementById("fbody").appendChild(a);
}
function identity_div(clicked_id)
{
	div_identity=clicked_id;
}
function div_control(e)
{
	var a=document.getElementById(e.target.dc_param);
	identity_div(e.target.dc_param);
	if(e.detail===2 && drag===1)
	{
		var ee=document.getElementById(a.id);
		ee.style.position="absolute";
		if(ee.getAttribute("state")==="0")ee.setAttribute("state","1");
		else if(ee.getAttribute("state")==="1")ee.setAttribute("state","0");
		dragElement(ee,ee.getAttribute("state"));
		console.log("Drag Mode On");
	}	
}
function dragElement(elmnt,state) 
{
	if(state==="1")
	{
		var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
  		if (document.getElementById(elmnt.id)) 
		{
    			/* if present, the header is where you move the DIV from:*/
   	 		document.getElementById(elmnt.id).onmousedown = dragMouseDown;
  		} 
		else 
		{
    			/* otherwise, move the DIV from anywhere inside the DIV:*/
    			elmnt.onmousedown = dragMouseDown;
  		}
  		function dragMouseDown(e) 
		{
    			e = e || window.event;
    			e.preventDefault();
    			// get the mouse cursor position at startup:
    			pos3 = e.clientX;
    			pos4 = e.clientY;
    			document.onmouseup = closeDragElement;
    			// call a function whenever the cursor moves:
    			document.onmousemove = elementDrag;
  		}
  		function elementDrag(e) 
		{
    			e = e || window.event;
    			e.preventDefault();
    			// calculate the new cursor position:
    			pos1 = pos3 - e.clientX;
    			pos2 = pos4 - e.clientY;
    			pos3 = e.clientX;
    			pos4 = e.clientY;
   			// set the element's new position:
    			elmnt.style.top = (elmnt.offsetTop - pos2) + "px";
    			elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";
  		}
  		function closeDragElement() 
		{
    			/* stop moving when mouse button is released:*/
    			document.onmouseup = null;
    			document.onmousemove = null;
  		}
	}
	else if(state==="0")
	{
		elmnt.style.position="fixed";
		elmnt.onmousedown = "";
	}
}
document.getElementById("sub_b").addEventListener("click",function(event)
{
	var text="<!DOCTYPE html><html><head></head><body>"+document.getElementById("fbody").innerHTML+"</body></html>";
	var data = new Blob([text], {type: 'text/html'});
	var url = window.URL.createObjectURL(data);
	document.getElementById('sub_b').href = url;
});
document.getElementById("drag_b").addEventListener("click",function(event)
{
	if(drag===0)
	{
		drag=1;
		
	}
	else if(drag===1)
	{
		drag=0;
	}
	console.log(drag);
});
</script>
</body>
</html>